# Notify Service VK

## Задача
Спроектировать и реализовать сервис, позволяющий делать рассылку уведомлений пользователям приложения социальной сети VK. А так же сервер заглушку эмулирующий API соцсети.

## Исходные данные
В базе данных есть таблица **players**, которая содержить N записей (N может быть равно нескольким миллионам).

Таблица имеет минимум 2 поля:
* vk_id - уникальный идентификатор пользователя (тип в бд выбрать самостоятельно)
* first_name - имя без фамилии/отчества (тип в бд text)

## API Stub server
Существует стаб-сервер vk-api, эмулирующий работу API социальной сети. Он имеет единственный асинхронный
эндпоинт /api/notification с параметрами (ids, text), где:
* ids - список id пользователей соц сети, которым отправляется уведомление (тип JSON Array)
* text - текст уведомления (тип JSON String)

Передача списка идентификаторов позволяет отправлять уведомление сразу нескольким пользователя, чтобы не пришлось вызывать его для каждого отдельного пользователя.
Данный сервис эмулирует отправку сообщения text соответствующим пользователям и возвращает список пользователей, которым удалось отправить нотификацию (у некоторых пользователей они могут быть отключены в настройках приложения).
Отвечает сервис на вызовы в формате JSON (спроектировать формат ответа самостоятельно, но включая требуемые в тз данные). В случае корректной работы он возвращает список ids, пользователей, кому была доставлена нотификация.
Так же он может возвращать одну из ошибок:
1. `code: 1, description: "Too frequently"`
2. `code: 2, description: "Server error"`
3. `code: 3, description: "Invalid data"`

Ограничения стаб сервиса:
* количество передаваемых id не должно превышать 100
* не более 5 запросов в секунду (существует ограничение соц сети, не позволяющее вызывать сервис часто)

## Требования к сервису нотификаций
Реализовать rest сервис, реализующий минимум один эндпоинт и принимающий минимум один обязательный параметр template с **шаблоном** сообщения. В результате обработки каждому пользователю, присутствующему в таблице **players**, должно быть отправлено уведомление по переданному шаблону. При этом текст template может содержать подстроку `"{user_name}"`, которую необходимо подменять значением поля first_name из таблицы **players**.
Сервис должен пользоваться эндпоинтом `/api/notification` реализованном в заглушке. В случае, если template содержит шаблон для имени, то нужно организовать вызов метода заглушки таким образом, чтобы в него передавались id игроков с одинаковыми именами.
Сервис должен настраиваться через конфигурационный файл, минимум параметры доступа к бд. Основное хранилище на ваше усмотрение sql/nosql. Реализовать сервис с учётом того что игроков много (миллионы) и нет возможности выгрузить все данные из бд в память.

## Требования к реализации
* Использовать Node.js LTS и JS ES6+
* Логирование доставки/не доставки нотификаий пользователям (в файл или в бд - на усмотрение разработчика)
* Правильная обработка ошибок, возвращаемых сервером заглушкой ( повтор запроса при ошибке "Too frequently" и прекращать работу с сохранением текущего состояния рассылки при ошибке "Server error" )
* При "падении" сервис должен продолжить работу таким образом, чтобы не отправлять сообщения повторно игрокам, которые их уже получили до "падения"
* Описать инструкцию по запуску и использованию сервиса

У разработчика сервиса нет ограничений в использовании средств (можно применять дополнительные бд, файлы на диске, любые сторонние библиотеки), но при этом расход "ресурсов" должен быть экономным и адекватным по отношению к целям.
Реализовывать работу с реальным API соц сети не нужно, реализация в заглушке считается достаточной.
